<div>Sondage en Cours
    <div id="vote" class="container" style="font-size: 25px;font-family:Arial">
    </div>
    <div id="errorMsg"></div>
</div>


<script>
    function clearVote(){
        $("#tableBody").html("");
    }
    $(document).ready(function () {
        $.ajax({
            url: './ParticipantServlet',
            method: 'POST',
            data: {
                action : 'infoSurvey'
            },
            dataType: 'json'
        }).done(function (data) {
            clearVote();
            var response = data;
            console.log(response);
            var state = 2;
            //var state = response.state;
            if(state === "1") {
                //No survey and impossible to create one
                $("#vote").html("<p>Aucun sondage pour le moment, veuillez revenir plus tard!</p>");
            } else if (state === 2) {
                //Moderator
                console.log(state);
                $("#vote").html("<p>Aucun sondage pour le moment, mais vous pouvez en creer un!</p>");
                var createQuestionDiv = document.createElement("div");
                createQuestionDiv.id = "createQuestion";
                document.getElementById("vote").appendChild(createQuestionDiv);
                $('#createQuestion').load("question-form.html");
            } else if (state === 3) {
                var question = response.question;
                var choices = response.choices;
                var publicKey = response.publicKey;
                var voteDiv = document.getElementById("vote");
                var questionDiv = document.createElement("div");
                questionDiv.innerHTML = question;
                questionDiv.id = "question";
                voteDiv.appendChild(questionDiv);
                var choicesDiv = document.createElement("div");
                choicesDiv.id = "choices";
                for(i = 0; i<choices.length; i++){
                    var choiceRadio = document.createElement("input");
                    choiceRadio.setAttribute("type", "radio");
                    choiceRadio.setAttribute("name", "voteChoices");
                    choiceRadio.setAttribute("value", choices[i]);
                    choicesDiv.appendChild(choiceRadio);
                }
                voteDiv.appendChild(choicesDiv);
                var sendButton = document.createElement("button");
                sendButton.id = "sendResponse";
                sendButton.onclick(function(){
                    var radioValue = $("input[name='voteChoices']:checked").val();
                    if(radioValue){
                        $.ajax({
                            url: './ParticipantServlet',
                            method: 'POST',
                            data: {
                                action : 'voteSurvey',
                                response : radioValue
                            },
                            dataType: 'json'
                        });
                    } else {
                        $("#errorMsg").innerHTML("Please select a value!");
                    }
                });
            }
        });
    });
</script>